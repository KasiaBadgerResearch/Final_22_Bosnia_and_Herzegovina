# How has the share of women in vulnerable employment evolved relative to that of men in Bosnia and Herzegovina between 1991 and 2023?

import pandas as pd
import matplotlib.pyplot as plt
import os

# Folders
data_raw_folder = "data_raw/"
data_clean_folder = "data_clean/"
figures_folder = "figures/"

# Load CSV
filename = "social-development_bih_filtered.csv"  # Filtered dataset with only relevant rows
df = pd.read_csv(os.path.join(data_raw_folder, filename))

# Keep only needed columns
df = df[["Year", "Indicator Name", "Value"]]

# Convert Year and Value to numeric, drop invalid rows
df["Year"] = pd.to_numeric(df["Year"], errors="coerce")
df["Value"] = pd.to_numeric(df["Value"], errors="coerce")
df = df.dropna(subset=["Year", "Value"])

# Pivot indicators into separate columns
df_pivot = df.pivot(index="Year", columns="Indicator Name", values="Value").reset_index()
df_pivot = df_pivot.sort_values("Year")

print("Pivoted Bosnia and Herzegovina dataset:")
display(df_pivot)

# Interpolate missing values for smooth plotting (optional)
df_plot = df_pivot.interpolate(method='linear')

# Plot the two indicators
plt.figure(figsize=(10,6))
plt.plot(df_plot["Year"], df_plot["Vulnerable employment, female (% of female employment) (modeled ILO estimate)"], 
         marker='o', linestyle='-', label="Vulnerable employment, female (% of female employment)")
plt.plot(df_plot["Year"], df_plot["Vulnerable employment, male (% of male employment) (modeled ILO estimate)"], 
         marker='o', linestyle='-', label="Vulnerable employment, male (% of male employment)")

plt.title("Bosnia and Herzegovina: Female vs Male vulnerable employment (%) (1991-2023)")
plt.xlabel("Year")
plt.ylabel("Percentage")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.savefig(os.path.join(figures_folder, "bosnia_and_herzegovina_female_vs_male_vulnerable_employment.png"))
plt.show()

# Save cleaned CSV
df_pivot.to_csv(os.path.join(data_clean_folder, "bosnia_and_herzegovina_female_vs_male_vulnerable_employment"), index=False)
